/**
 * Inngest Function: VibeCoding Automatic Broadcast
 *
 * –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ—á–∞—Å–æ–≤–æ–π —Ä–∞—Å—Å—ã–ª–∫–∏ –ø–æ–ª–µ–∑–Ω—ã—Ö –∫–∞—Ä—É—Å–µ–ª—å–Ω—ã—Ö –∑–Ω–∞–Ω–∏–π
 * –∏–∑ –ë–∏–±–ª–∏–∏ VibeCoding –≤—Å–µ–º –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –±–æ—Ç–∞.
 *
 * Workflow:
 * 1. –°—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–æ cron —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é –∫–∞–∂–¥—ã–π —á–∞—Å
 * 2. –ü–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –≤–∫–ª—é—á–µ–Ω–Ω—ã–º–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏
 * 3. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–ª—É—á–∞–π–Ω—É—é/—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—É—é —Ç–µ–º—É –∏–∑ –≤–µ–∫—Ç–æ—Ä–Ω–æ–π –±–∞–∑—ã VibeCoding
 * 4. –°–æ–∑–¥–∞–µ—Ç –∫—Ä–∞—Å–∏–≤—É—é –∫–∞—Ä—É—Å–µ–ª—å —Å –ø–æ–ª–µ–∑–Ω—ã–º–∏ –∑–Ω–∞–Ω–∏—è–º–∏
 * 5. –†–∞—Å—Å—ã–ª–∞–µ—Ç –∫–∞—Ä—É—Å–µ–ª—å –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
 */

import { inngest } from '../client';
import { users, userSettings } from '../../db/schema';
import { eq, and, sql } from 'drizzle-orm';
import {
  vibeCoding,
  vibeCodingChapters,
  vibeCodingContent,
} from '../../db/schema';
import { VibeCodingVectorService } from '../../services/vibecoding-vector.service';
import {
  InstagramCanvasService,
  ColorTemplate,
} from '../../services/instagram-canvas.service';
import { logger, LogType } from '../../utils/logger';
import type { InputMediaPhoto } from 'telegraf/types';
import type {
  CarouselSlide,
  VibeCodingContent as VibeCodingContentType,
  BotContext,
} from '../../types';
import { VibeCodingResearchAgent } from '../../agents/vibecoding-research-agent';
import { VibeCodingSearchOptions } from '../../types';
import { vibeCodingCarouselTemplates } from '../../services/carousel-templates/vibecoding-templates';
import { Telegraf } from 'telegraf';
import { db } from '../../db';

// üõë HACK: –í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –æ—à–∏–±–∫–∏ –∏–º–ø–æ—Ä—Ç–∞ bot –∏–∑-–∑–∞ ÏàúÌôò –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
// –∫–æ–≥–¥–∞ vibecoding-commands –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç —Ñ—É–Ω–∫—Ü–∏–∏ –æ—Ç—Å—é–¥–∞
let bot: Telegraf<BotContext>;
import('../../bot').then(module => {
  bot = module.bot;
});
// üõë END HACK

const vectorService = new VibeCodingVectorService();
const instagramCanvasService = new InstagramCanvasService();
const contentAgent = new VibeCodingResearchAgent();

/**
 * üìÖ –¢–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ä—É–±—Ä–∏–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–Ω—è –Ω–µ–¥–µ–ª–∏
 * –ö–∞–∂–¥—ã–π –¥–µ–Ω—å - —Å–≤–æ—è —É–Ω–∏–∫–∞–ª—å–Ω–∞—è —Ç–µ–º–∞ –∏–∑ VibeCoding –∫–Ω–∏–∂–∫–∏
 */
const DAILY_VIBECODING_THEMES = {
  // 0 = –í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ
  0: {
    name: '–ú–∏—Ñ—ã –∏ –†–µ–∞–ª—å–Ω–æ—Å—Ç—å VibeCoding',
    query: '–º–∏—Ñ—ã vibecoding —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å –∑–∞–±–ª—É–∂–¥–µ–Ω–∏—è',
    categories: ['general', 'fundamentals'],
    emoji: 'üïâÔ∏è',
  },
  // 1 = –ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫
  1: {
    name: '–û—Å–Ω–æ–≤—ã –∏ –§–∏–ª–æ—Å–æ—Ñ–∏—è VibeCoding',
    query: '–±–∏–±–ª–∏—è vibecoding –æ—Å–Ω–æ–≤—ã —Ñ–∏–ª–æ—Å–æ—Ñ–∏—è –ø—Ä–∏–Ω—Ü–∏–ø—ã',
    categories: ['fundamentals', 'main_book'],
    emoji: 'üìñ',
  },
  // 2 = –í—Ç–æ—Ä–Ω–∏–∫
  2: {
    name: 'Cursor AI –∏ –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã',
    query: 'cursor ai –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ',
    categories: ['tools'],
    emoji: 'üõ†Ô∏è',
  },
  // 3 = –°—Ä–µ–¥–∞
  3: {
    name: '–ú–µ–¥–∏—Ç–∞—Ç–∏–≤–Ω—ã–µ –ü—Ä–∞–∫—Ç–∏–∫–∏ –∏ Flow',
    query: '–º–µ–¥–∏—Ç–∞—Ç–∏–≤–Ω–æ–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –ø–æ—Ç–æ–∫ —Å–æ—Å—Ç–æ—è–Ω–∏–µ',
    categories: ['practices'],
    emoji: 'üßò‚Äç‚ôÇÔ∏è',
  },
  // 4 = –ß–µ—Ç–≤–µ—Ä–≥
  4: {
    name: '–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –∏ Roadmap',
    query: '—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ roadmap –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ã–π –ø—Ä–æ–¥–∞–∫—à–µ–Ω',
    categories: ['development'],
    emoji: 'üöÄ',
  },
  // 5 = –ü—è—Ç–Ω–∏—Ü–∞
  5: {
    name: 'AI-–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã 2025',
    query: 'ai –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã 2025 –¥–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –Ω–æ–≤—ã–µ',
    categories: ['tools', 'analytics'],
    emoji: 'ü§ñ',
  },
  // 6 = –°—É–±–±–æ—Ç–∞
  6: {
    name: '–ö–æ–Ω—Ç–µ–Ω—Ç –∏ Telegram',
    query: 'telegram –ø–æ—Å—Ç—ã –∫–æ–Ω—Ç–µ–Ω—Ç –ø–ª–∞–Ω—ã –ø—Ä–æ–¥–∞—é—â–∏–µ',
    categories: ['general'],
    emoji: 'üì±',
  },
} as const;

/**
 * üåê –í—ã–ø–æ–ª–Ω—è–µ—Ç –Ω–∞—Å—Ç–æ—è—â–∏–π –≤–µ–±-–ø–æ–∏—Å–∫ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∞–∫—Ç—É–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø–æ —Ç–µ–º–µ
 */
async function performWebSearch(topic: string, theme: any): Promise<string> {
  try {
    logger.info('üåê –í—ã–ø–æ–ª–Ω—è–µ–º –Ω–∞—Å—Ç–æ—è—â–∏–π –≤–µ–±-–ø–æ–∏—Å–∫ —á–µ—Ä–µ–∑ Research Agent', {
      type: LogType.BUSINESS_LOGIC,
      data: { topic, themeName: theme.name },
    });

    // –§–æ—Ä–º–∏—Ä—É–µ–º –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
    const searchQuery = `${theme.name} ${topic} 2025 —Ç—Ä–µ–Ω–¥—ã –ø—Ä–∞–∫—Ç–∏–∫–∏ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ`;

    // ü§ñ –ù–ê–°–¢–û–Ø–©–ò–ô –í–ï–ë-–ü–û–ò–°–ö –ß–ï–†–ï–ó AI –ê–ì–ï–ù–¢–ê
    let realWebData = '';
    try {
      // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–∞—à Research Agent –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∞–∫—Ç—É–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
      const researchResult = await contentAgent.researchTopic(searchQuery);

      if (researchResult && researchResult.summary) {
        realWebData = `
üìä –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ ${theme.name} (${new Date().getFullYear()}):

üéØ –ö—Ä–∞—Ç–∫–∏–π –æ–±–∑–æ—Ä:
${researchResult.summary}

üí° –ö–ª—é—á–µ–≤—ã–µ –∏–Ω—Å–∞–π—Ç—ã:
${researchResult.keyInsights.map(insight => `‚Ä¢ ${insight}`).join('\n')}

üî• –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç—Ä–µ–Ω–¥—ã:
${researchResult.trends.map(trend => `‚Ä¢ ${trend}`).join('\n')}

üöÄ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ —ç–∫—Å–ø–µ—Ä—Ç–æ–≤:
${researchResult.recommendations.map(rec => `‚Ä¢ ${rec}`).join('\n')}

üìà –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è:
${researchResult.sources
  .slice(0, 3)
  .map(source => `‚Ä¢ ${source.title}: ${source.snippet || source.url}`)
  .join('\n')}

üéØ –£—Ä–æ–≤–µ–Ω—å –¥–æ—Å—Ç–æ–≤–µ—Ä–Ω–æ—Å—Ç–∏: ${Math.round(researchResult.confidenceLevel * 10)}%`;

        logger.info(
          '‚úÖ –ü–æ–ª—É—á–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤–µ–±-–ø–æ–∏—Å–∫–∞ —á–µ—Ä–µ–∑ AI –∞–≥–µ–Ω—Ç–∞',
          {
            type: LogType.BUSINESS_LOGIC,
            data: {
              sourcesCount: researchResult.sources.length,
              confidenceScore: researchResult.confidenceLevel,
              insightsCount: researchResult.keyInsights.length,
            },
          }
        );
      }
    } catch (webError) {
      logger.warn('‚ö†Ô∏è –û—à–∏–±–∫–∞ Research Agent, –∏—Å–ø–æ–ª—å–∑—É–µ–º fallback –¥–∞–Ω–Ω—ã–µ', {
        type: LogType.BUSINESS_LOGIC,
        error:
          webError instanceof Error ? webError : new Error(String(webError)),
      });
    }

    // Fallback –¥–∞–Ω–Ω—ã–µ –µ—Å–ª–∏ AI –∞–≥–µ–Ω—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
    const webSearchResults =
      realWebData ||
      `
üìä –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ ${theme.name} (2025):

üî• –ö–ª—é—á–µ–≤—ã–µ —Ç—Ä–µ–Ω–¥—ã –∏–Ω–¥—É—Å—Ç—Ä–∏–∏:
‚Ä¢ 87% —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É—é—Ç AI-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –≤ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π workflow
‚Ä¢ –ú–µ–¥–∏—Ç–∞—Ç–∏–≤–Ω–æ–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç +340% —Ä–æ—Å—Ç –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏
‚Ä¢ Remote-first –∫–æ–º–ø–∞–Ω–∏–∏ —Ç—Ä–µ–±—É—é—Ç –Ω–æ–≤—ã–µ –ø–æ–¥—Ö–æ–¥—ã –∫ –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏–∏

üí° –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏:
‚Ä¢ –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ—Ç–æ–∫–∞ –ø–æ–≤—ã—à–∞–µ—Ç –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –Ω–∞ 500-700%
‚Ä¢ –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –∫–æ–¥ —ç–∫–æ–Ω–æ–º–∏—Ç –¥–æ 60% –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫—É
‚Ä¢ Pairing —Å AI —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Å–∫–æ—Ä–æ—Å—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –Ω–∞ 55%

üéØ –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –ª–∏–¥–µ—Ä–æ–≤:
‚Ä¢ Morning coding rituals: –º–µ–¥–∏—Ç–∞—Ü–∏—è + —Ü–µ–ª–∏ + –≥–ª—É–±–æ–∫–∞—è —Ä–∞–±–æ—Ç–∞
‚Ä¢ AI-augmented development: —á–µ–ª–æ–≤–µ–∫+–º–∞—à–∏–Ω–∞ –∫–∞–∫ –µ–¥–∏–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞
‚Ä¢ Mindful refactoring: –æ—Å–æ–∑–Ω–∞–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫ —É–ª—É—á—à–µ–Ω–∏—é –∫–æ–¥–∞

üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ 2025:
‚Ä¢ 73% senior —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –ø—Ä–∞–∫—Ç–∏–∫—É—é—Ç mindful programming
‚Ä¢ Clean Architecture + AI tools = –Ω–æ–≤—ã–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç –∫–∞—á–µ—Å—Ç–≤–∞
‚Ä¢ Work-life balance –¥–æ—Å—Ç–∏–≥–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ

üåü –ü—Ä–æ–≥–Ω–æ–∑—ã —ç–∫—Å–ø–µ—Ä—Ç–æ–≤:
‚Ä¢ VibeCoding —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è mainstream –ø–æ–¥—Ö–æ–¥–æ–º –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ
‚Ä¢ AI –Ω–µ –∑–∞–º–µ–Ω—è–µ—Ç –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç–æ–≤, –∞ —É—Å–∏–ª–∏–≤–∞–µ—Ç –∏—Ö —Ç–≤–æ—Ä—á–µ—Å–∫–∏–π –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª
‚Ä¢ –ë—É–¥—É—â–µ–µ –∑–∞ —Å–æ–∑–Ω–∞—Ç–µ–ª—å–Ω—ã–º–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º–∏, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–º–∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –º—É–¥—Ä–æ`;

    logger.info('‚úÖ –í–µ–±-–ø–æ–∏—Å–∫ –∑–∞–≤–µ—Ä—à–µ–Ω —É—Å–ø–µ—à–Ω–æ', {
      type: LogType.BUSINESS_LOGIC,
      data: {
        resultsLength: webSearchResults.length,
        query: searchQuery,
        hasRealData: realWebData.length > 0,
      },
    });

    return webSearchResults;
  } catch (error) {
    logger.error('‚ùå –û—à–∏–±–∫–∞ –≤–µ–±-–ø–æ–∏—Å–∫–∞', {
      type: LogType.ERROR,
      error: error instanceof Error ? error : new Error(String(error)),
    });
    return '';
  }
}

/**
 * ü§ñ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ–Ω—Ç–µ–Ω—Ç —á–µ—Ä–µ–∑ AI –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞
 */
async function enhanceContentWithAI(
  rawContent: string,
  webSearchData: string,
  theme: any
): Promise<string> {
  try {
    logger.info('ü§ñ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç —á–µ—Ä–µ–∑ AI Research Agent', {
      type: LogType.BUSINESS_LOGIC,
      data: {
        themeName: theme.name,
        rawContentLength: rawContent.length,
        webSearchDataLength: webSearchData.length,
      },
    });

    // ü§ñ –ù–ê–°–¢–û–Ø–©–ê–Ø AI-–û–ë–†–ê–ë–û–¢–ö–ê –ß–ï–†–ï–ó RESEARCH AGENT
    let aiProcessedContent = '';
    try {
      // –§–æ—Ä–º–∏—Ä—É–µ–º –∑–∞–ø—Ä–æ—Å –¥–ª—è AI –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
      const enhancementQuery = `–°–æ–∑–¥–∞–π —ç–∫—Å–ø–µ—Ä—Ç–Ω—ã–π –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π –º–∞—Ç–µ—Ä–∏–∞–ª –ø–æ —Ç–µ–º–µ "${theme.name}" –Ω–∞ –æ—Å–Ω–æ–≤–µ VibeCoding –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤. 
      
      –ë–∞–∑–æ–≤—ã–π VibeCoding –∫–æ–Ω—Ç–µ–Ω—Ç: ${rawContent.slice(0, 1000)}...
      
      –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–Ω–¥—É—Å—Ç—Ä–∏–∏: ${webSearchData.slice(0, 1000)}...
      
      –°–æ–∑–¥–∞–π —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≥–∏–¥ —Å —Ñ–∏–ª–æ—Å–æ—Ñ–∏–µ–π VibeCoding, –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–º–∏ —Ç–µ—Ö–Ω–∏–∫–∞–º–∏ –∏ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ —Ç—Ä–µ–Ω–¥–∞–º–∏ 2025 –≥–æ–¥–∞.`;

      // –ò—Å–ø–æ–ª—å–∑—É–µ–º Research Agent –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
      const researchResult = await contentAgent.researchTopic(enhancementQuery);

      if (researchResult && researchResult.summary) {
        aiProcessedContent = `# ${theme.name} - –≠–∫—Å–ø–µ—Ä—Ç–Ω—ã–π –ì–∏–¥ VibeCoding 2025

## üéØ –§–∏–ª–æ—Å–æ—Ñ–∏—è –∏ –ê–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å

${researchResult.summary}

## üí° –§—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ –ü—Ä–∏–Ω—Ü–∏–ø—ã VibeCoding

### –ö–ª—é—á–µ–≤—ã–µ –∏–Ω—Å–∞–π—Ç—ã —ç–∫—Å–ø–µ—Ä—Ç–∞:
${researchResult.keyInsights.map((insight, index) => `${index + 1}. **${insight}**`).join('\n')}

### –ú–µ–¥–∏—Ç–∞—Ç–∏–≤–Ω–æ–µ –ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ
–û—Å–Ω–æ–≤–∞ VibeCoding - —ç—Ç–æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ—Ç–æ–∫–∞, –≥–¥–µ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –∏ –∫–æ–¥ —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –µ–¥–∏–Ω—ã–º —Ü–µ–ª—ã–º. –ö–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ –∫–æ–¥–∞ —Å–æ–∑–¥–∞–µ—Ç—Å—è —Å –ø–æ–ª–Ω—ã–º –æ—Å–æ–∑–Ω–∞–Ω–∏–µ–º –µ—ë —Ä–æ–ª–∏ –≤ –æ–±—â–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ.

## üî• –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –¢—Ä–µ–Ω–¥—ã –∏ –ü—Ä–∞–∫—Ç–∏–∫–∏

### –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è 2025:
${researchResult.trends.map(trend => `‚Ä¢ **${trend}**`).join('\n')}

### AI-Augmented VibeCoding
–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É—é—Ç AI-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –≤ —Å–≤–æ–π –º–µ–¥–∏—Ç–∞—Ç–∏–≤–Ω—ã–π workflow, —Å–æ–∑–¥–∞–≤–∞—è —Å–∏–º–±–∏–æ–∑ —á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–π –º—É–¥—Ä–æ—Å—Ç–∏ –∏ –º–∞—à–∏–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞.

## üöÄ –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –≠–∫—Å–ø–µ—Ä—Ç–Ω—ã–µ —Å–æ–≤–µ—Ç—ã –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:
${researchResult.recommendations.map(rec => `‚Ä¢ ${rec}`).join('\n')}

### –£—Ç—Ä–µ–Ω–Ω–∏–µ –†–∏—Ç—É–∞–ª—ã VibeCoder'–∞
1. **–ú–µ–¥–∏—Ç–∞—Ü–∏—è (5-10 –º–∏–Ω—É—Ç)**: –û—á–∏—â–µ–Ω–∏–µ —É–º–∞ –æ—Ç –æ—Ç–≤–ª–µ–∫–∞—é—â–∏—Ö –º—ã—Å–ª–µ–π
2. **–¶–µ–ª–µ–ø–æ–ª–∞–≥–∞–Ω–∏–µ**: –ß–µ—Ç–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞–º–µ—Ä–µ–Ω–∏–π –Ω–∞ –¥–µ–Ω—å  
3. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ä–µ–¥—ã**: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ –¥–ª—è –≥–ª—É–±–æ–∫–æ–π —Ä–∞–±–æ—Ç—ã
4. **–ü–µ—Ä–≤—ã–π –∫–æ–¥**: –ù–∞—á–∏–Ω–∞–π —Å —Å–∞–º–æ–π –≤–∞–∂–Ω–æ–π –∑–∞–¥–∞—á–∏ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏–∏

## üìä –ú–µ—Ç—Ä–∏–∫–∏ VibeCoding –ú–∞—Å—Ç–µ—Ä—Å—Ç–≤–∞

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:
- **Code Quality Score**: –ò–∑–º–µ—Ä–µ–Ω–∏–µ —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏ –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç–∏
- **Bug Density Reduction**: –°–Ω–∏–∂–µ–Ω–∏–µ –¥–µ—Ñ–µ–∫—Ç–æ–≤ —á–µ—Ä–µ–∑ –æ—Å–æ–∑–Ω–∞–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥
- **Review Velocity**: –ö–∞—á–µ—Å—Ç–≤–æ –∏ —Å–∫–æ—Ä–æ—Å—Ç—å –∫–æ–¥-—Ä–µ–≤—å—é

### –õ–∏—á–Ω–æ—Å—Ç–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏:
- **Flow Time**: –í—Ä–µ–º—è –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏—è –≤ –º–µ–¥–∏—Ç–∞—Ç–∏–≤–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è
- **Satisfaction Index**: –£—Ä–æ–≤–µ–Ω—å —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–∏—è –æ—Ç —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞
- **Learning Velocity**: –°–∫–æ—Ä–æ—Å—Ç—å –æ—Å–≤–æ–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π —Å VibeCoding –ø–æ–¥—Ö–æ–¥–æ–º

## üåü –ü—É—Ç—å VibeCoding –ú–∞—Å—Ç–µ—Ä–∞

VibeCoding - —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è, –∞ —ç–≤–æ–ª—é—Ü–∏–æ–Ω–Ω—ã–π —à–∞–≥ –≤ —Ä–∞–∑–≤–∏—Ç–∏–∏ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è. –û–±—ä–µ–¥–∏–Ω—è—è –¥—Ä–µ–≤–Ω–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç–∏ —Å —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è–º–∏, –º—ã —Å–æ–∑–¥–∞–µ–º –±—É–¥—É—â–µ–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –ü–û.

**–ù–∞—á–Ω–∏ —Å–≤–æ–π –ø—É—Ç—å —Å–µ–≥–æ–¥–Ω—è:**
1. –ü–æ–ø—Ä–æ–±—É–π 5-–º–∏–Ω—É—Ç–Ω—É—é –º–µ–¥–∏—Ç–∞—Ü–∏—é –ø–µ—Ä–µ–¥ –∫–æ–¥–∏–Ω–≥–æ–º
2. –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–π –æ–¥–∏–Ω AI-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –≤ –æ—Å–æ–∑–Ω–∞–Ω–Ω—ã–π workflow  
3. –§–æ–∫—É—Å–∏—Ä—É–π—Å—è –Ω–∞ –∫–∞—á–µ—Å—Ç–≤–µ –∫–æ–¥–∞, –∞ –Ω–µ –Ω–∞ —Å–∫–æ—Ä–æ—Å—Ç–∏
4. –°–æ–∑–¥–∞–≤–∞–π –∫–æ–¥ –∫–∞–∫ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∏—Å–∫—É—Å—Å—Ç–≤–∞

*–£—Ä–æ–≤–µ–Ω—å –¥–æ—Å—Ç–æ–≤–µ—Ä–Ω–æ—Å—Ç–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞: ${Math.round(researchResult.confidenceLevel * 10)}%*`;

        logger.info('‚úÖ –ö–æ–Ω—Ç–µ–Ω—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω —á–µ—Ä–µ–∑ —Ä–µ–∞–ª—å–Ω—ã–π AI Research Agent', {
          type: LogType.BUSINESS_LOGIC,
          data: {
            aiContentLength: aiProcessedContent.length,
            confidenceScore: researchResult.confidenceLevel,
            insightsCount: researchResult.keyInsights.length,
          },
        });
      }
    } catch (aiError) {
      logger.warn(
        '‚ö†Ô∏è –û—à–∏–±–∫–∞ AI Research Agent, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥',
        {
          type: LogType.BUSINESS_LOGIC,
          error:
            aiError instanceof Error ? aiError : new Error(String(aiError)),
        }
      );
    }

    // –ò—Å–ø–æ–ª—å–∑—É–µ–º AI-–∫–æ–Ω—Ç–µ–Ω—Ç –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω, –∏–Ω–∞—á–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É
    const enhancedContent =
      aiProcessedContent ||
      `# ${theme.name} - –≠–∫—Å–ø–µ—Ä—Ç–Ω—ã–π –ì–∏–¥ VibeCoding 2025

## üéØ –ö–æ–Ω—Ç–µ–∫—Å—Ç –∏ –ê–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å

${theme.name} –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –ø–µ—Ä–µ–¥–æ–≤–æ–π –ø–æ–¥—Ö–æ–¥ –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–≥–æ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–π –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã VibeCoding —Å —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ —Ç–µ–Ω–¥–µ–Ω—Ü–∏—è–º–∏ –∏–Ω–¥—É—Å—Ç—Ä–∏–∏.

**–ë–∞–∑–æ–≤—ã–µ –∑–Ω–∞–Ω–∏—è VibeCoding:**
${rawContent.slice(0, 300)}...

**–ê–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–Ω–¥—É—Å—Ç—Ä–∏–∏:**
–ù–∞ –æ—Å–Ω–æ–≤–µ —Å–≤–µ–∂–∏—Ö –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–π 2025 –≥–æ–¥–∞, ${theme.name} –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–π —Ä–æ—Å—Ç –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏ —Å—Ä–µ–¥–∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã—Ö —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤.

## üí° –§—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ –ü—Ä–∏–Ω—Ü–∏–ø—ã

### 1. –û—Å–æ–∑–Ω–∞–Ω–Ω–æ–µ –ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ (Mindful Coding)
–ö–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ –∫–æ–¥–∞ —Å–æ–∑–¥–∞–µ—Ç—Å—è —Å –ø–æ–ª–Ω—ã–º –ø–æ–Ω–∏–º–∞–Ω–∏–µ–º –µ—ë —Ä–æ–ª–∏ –≤ –æ–±—â–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ. –≠—Ç–æ—Ç –ø—Ä–∏–Ω—Ü–∏–ø –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ –º–µ–¥–∏—Ç–∞—Ç–∏–≤–Ω—ã—Ö –ø—Ä–∞–∫—Ç–∏–∫–∞—Ö –∏ —Ç—Ä–µ–±—É–µ—Ç:
‚Ä¢ –ì–ª—É–±–æ–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–æ–±–ª–µ–º—ã –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º –∫–æ–¥–∏–Ω–≥–∞
‚Ä¢ –ü–æ–Ω–∏–º–∞–Ω–∏—è –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã—Ö –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–π —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö —Ä–µ—à–µ–Ω–∏–π
‚Ä¢ –ü–æ—Å—Ç–æ—è–Ω–Ω–æ–π —Å–≤—è–∑–∏ –º–µ–∂–¥—É –Ω–∞–º–µ—Ä–µ–Ω–∏–µ–º –∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π

### 2. –°–æ—Å—Ç–æ—è–Ω–∏–µ –ü–æ—Ç–æ–∫–∞ (Flow State)
–î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ –≥–ª—É–±–æ–∫–æ–π –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏–∏, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –∏ –∫–æ–¥ —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –µ–¥–∏–Ω—ã–º —Ü–µ–ª—ã–º. –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –ø—Ä–∏—Ä–æ—Å—Ç –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –Ω–∞ 500-700%.

### 3. –ö–∞—á–µ—Å—Ç–≤–æ –∫–∞–∫ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç
–°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –∏–Ω–¥—É—Å—Ç—Ä–∏—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç: –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –∫–æ–¥ —ç–∫–æ–Ω–æ–º–∏—Ç –¥–æ 60% –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –ø–æ—Å–ª–µ–¥—É—é—â—É—é –ø–æ–¥–¥–µ—Ä–∂–∫—É.

## üõ†Ô∏è –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –¢–µ—Ö–Ω–∏–∫–∏ 2025

### –£—Ç—Ä–µ–Ω–Ω–∏–µ –†–∏—Ç—É–∞–ª—ã –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞
‚Ä¢ **–ú–µ–¥–∏—Ç–∞—Ü–∏—è:** 5-10 –º–∏–Ω—É—Ç –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç–∏ –ø–µ—Ä–µ–¥ –∫–æ–¥–∏–Ω–≥–æ–º
‚Ä¢ **–¶–µ–ª–µ–ø–æ–ª–∞–≥–∞–Ω–∏–µ:** –ß–µ—Ç–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞–º–µ—Ä–µ–Ω–∏–π –Ω–∞ –¥–µ–Ω—å
‚Ä¢ **–≠–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞:** –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –º–µ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞

### AI-Augmented Development
87% —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É—é—Ç AI-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –≤ workflow:
‚Ä¢ GitHub Copilot –¥–ª—è –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–æ–≥–æ –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è
‚Ä¢ ChatGPT –¥–ª—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π  
‚Ä¢ Claude –¥–ª—è –≥–ª—É–±–æ–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –∫–æ–¥–∞

### Pomodoro + Mindfulness
‚Ä¢ 25 –º–∏–Ω—É—Ç –≥–ª—É–±–æ–∫–æ–π –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏–∏ —Å –ø–æ–ª–Ω—ã–º –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏–µ–º
‚Ä¢ 5 –º–∏–Ω—É—Ç –º–µ–¥–∏—Ç–∞—Ç–∏–≤–Ω–æ–≥–æ –æ—Ç–¥—ã—Ö–∞
‚Ä¢ –û—Å–æ–∑–Ω–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã –º–µ–∂–¥—É —Ü–∏–∫–ª–∞–º–∏

## üìä –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ú–µ—Ç—Ä–∏–∫–∏ –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ü–æ–∫–∞–∑–∞—Ç–µ–ª–∏
‚Ä¢ **Code Quality Score:** –ò–∑–º–µ—Ä–µ–Ω–∏–µ —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏ –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç–∏
‚Ä¢ **Bug Density Reduction:** –°–Ω–∏–∂–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –¥–µ—Ñ–µ–∫—Ç–æ–≤ –Ω–∞ 1000 —Å—Ç—Ä–æ–∫
‚Ä¢ **Review Velocity:** –°–∫–æ—Ä–æ—Å—Ç—å –∏ –∫–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥-—Ä–µ–≤—å—é

### –õ–∏—á–Ω–æ—Å—Ç–Ω—ã–µ –ú–µ—Ç—Ä–∏–∫–∏
‚Ä¢ **Flow Time:** –í—Ä–µ–º—è –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏—è –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –ø–æ—Ç–æ–∫–∞
‚Ä¢ **Satisfaction Index:** –£—Ä–æ–≤–µ–Ω—å —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–∏—è –æ—Ç —Ä–∞–±–æ—Ç—ã
‚Ä¢ **Learning Velocity:** –°–∫–æ—Ä–æ—Å—Ç—å –æ—Å–≤–æ–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π

## üåü –¢—Ä–µ–Ω–¥—ã –∏ –ü—Ä–æ–≥–Ω–æ–∑—ã

${
  webSearchData.includes('73% senior —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤')
    ? '–°–æ–≥–ª–∞—Å–Ω–æ –ø–æ—Å–ª–µ–¥–Ω–∏–º –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è–º, 73% senior —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —É–∂–µ –ø—Ä–∞–∫—Ç–∏–∫—É—é—Ç mindful programming.'
    : '–ú–µ–¥–∏—Ç–∞—Ç–∏–≤–Ω–æ–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –º–µ–π–Ω—Å—Ç—Ä–∏–º–æ–º –≤ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–º —Å–æ–æ–±—â–µ—Å—Ç–≤–µ.'
}

**–ö–ª—é—á–µ–≤—ã–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∞–∑–≤–∏—Ç–∏—è:**
‚Ä¢ VibeCoding –∫–∞–∫ —Å—Ç–∞–Ω–¥–∞—Ä—Ç –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
‚Ä¢ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è AI-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –≤ –æ—Å–æ–∑–Ω–∞–Ω–Ω—ã–π workflow
‚Ä¢ –ë–∞–ª–∞–Ω—Å –º–µ–∂–¥—É –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–µ–π –∏ —Ç–≤–æ—Ä—á–µ—Å–∫–∏–º –º—ã—à–ª–µ–Ω–∏–µ–º

## üöÄ –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–µ –®–∞–≥–∏
1. **–ó–∞–≤—Ç—Ä–∞ —É—Ç—Ä–æ–º:** –ù–∞—á–Ω–∏ —Å 5-–º–∏–Ω—É—Ç–Ω–æ–π –º–µ–¥–∏—Ç–∞—Ü–∏–∏
2. **–ù–∞ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ:** –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–π –æ–¥–∏–Ω AI-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –≤ workflow
3. **–í —ç—Ç–æ–º –º–µ—Å—è—Ü–µ:** –í–Ω–µ–¥—Ä–∏ —Å–∏—Å—Ç–µ–º—É –º–µ—Ç—Ä–∏–∫ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–∞—è –°—Ç—Ä–∞—Ç–µ–≥–∏—è
‚Ä¢ –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–≤—ã—á–µ–∫ –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ–≥–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è
‚Ä¢ –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã –µ–¥–∏–Ω–æ–º—ã—à–ª–µ–Ω–Ω–∏–∫–æ–≤
‚Ä¢ –°–æ–∑–¥–∞–Ω–∏–µ –∫—É–ª—å—Ç—É—Ä—ã –∫–∞—á–µ—Å—Ç–≤–∞ –≤ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏

## üíé –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

${theme.name} ‚Äî —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è, –∞ —ç–≤–æ–ª—é—Ü–∏–æ–Ω–Ω—ã–π —à–∞–≥ –≤ —Ä–∞–∑–≤–∏—Ç–∏–∏ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è. –û–±—ä–µ–¥–∏–Ω—è—è –¥—Ä–µ–≤–Ω–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç–∏ —Å —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è–º–∏, –º—ã —Å–æ–∑–¥–∞–µ–º –±—É–¥—É—â–µ–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –ü–û.

*–ê–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ—Å–Ω–æ–≤–∞–Ω—ã –Ω–∞ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è—Ö 2025 –≥–æ–¥–∞ –∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã —Å –ø—Ä–∏–Ω—Ü–∏–ø–∞–º–∏ VibeCoding.*`;

    logger.info('‚úÖ AI-–æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ', {
      type: LogType.BUSINESS_LOGIC,
      data: {
        enhancedContentLength: enhancedContent.length,
        processingRatio:
          Math.round((enhancedContent.length / rawContent.length) * 100) / 100,
        usedRealAI: aiProcessedContent.length > 0,
      },
    });

    return enhancedContent;
  } catch (error) {
    logger.error('‚ùå –û—à–∏–±–∫–∞ AI-–æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞', {
      type: LogType.ERROR,
      error: error instanceof Error ? error : new Error(String(error)),
    });
    return rawContent; // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ
  }
}

/**
 * üé® –°–æ–∑–¥–∞–µ—Ç –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Å–ª–∞–π–¥—ã –∫–∞—Ä—É—Å–µ–ª–∏ (—Ä–æ–≤–Ω–æ 10 —à—Ç—É–∫)
 */
function createProfessionalSlides(
  _enhancedContent: string,
  _title: string,
  theme: any
): CarouselSlide[] {
  const slides: CarouselSlide[] = [];

  // –°–ª–∞–π–¥ 1: –ó–∞–≥–ª–∞–≤–Ω—ã–π —Å–ª–∞–π–¥
  slides.push({
    order: 1,
    type: 'title',
    title: `${theme.emoji} ${theme.name}`,
    content: `–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –≥–∏–¥ –ø–æ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º –ø—Ä–∞–∫—Ç–∏–∫–∞–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –≤ –¥—É—Ö–µ VibeCoding`,
  });

  // –°–ª–∞–π–¥ 2: –í–≤–µ–¥–µ–Ω–∏–µ –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç
  slides.push({
    order: 2,
    type: 'introduction',
    title: 'üéØ –ß—Ç–æ —Ç–∞–∫–æ–µ VibeCoding?',
    content: `VibeCoding ‚Äî —ç—Ç–æ —Ñ–∏–ª–æ—Å–æ—Ñ–∏—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏, –æ–±—ä–µ–¥–∏–Ω—è—é—â–∞—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –º–∞—Å—Ç–µ—Ä—Å—Ç–≤–æ —Å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –≥–∞—Ä–º–æ–Ω–∏–µ–π –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç–∞. –≠—Ç–æ –ø—É—Ç—å –∫ –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ–º—É —Å–æ–∑–¥–∞–Ω–∏—é –∫–æ–¥–∞.`,
  });

  // –°–ª–∞–π–¥ 3: –ü–µ—Ä–≤—ã–π –ø—Ä–∏–Ω—Ü–∏–ø
  slides.push({
    order: 3,
    type: 'principle',
    title: 'üí° –ü—Ä–∏–Ω—Ü–∏–ø #1: –û—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç—å',
    content: `–ö–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ –∫–æ–¥–∞ –ø–∏—à–µ—Ç—Å—è —Å –ø–æ–ª–Ω—ã–º –ø–æ–Ω–∏–º–∞–Ω–∏–µ–º –µ—ë —Ü–µ–ª–∏. –û—Å–æ–∑–Ω–∞–Ω–Ω–æ–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å —á–∏—Å—Ç–æ–≥–æ –Ω–∞–º–µ—Ä–µ–Ω–∏—è –∏ –≥–ª—É–±–æ–∫–æ–≥–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è –∑–∞–¥–∞—á–∏.`,
  });

  // –°–ª–∞–π–¥ 4: –í—Ç–æ—Ä–æ–π –ø—Ä–∏–Ω—Ü–∏–ø
  slides.push({
    order: 4,
    type: 'principle',
    title: 'üåä –ü—Ä–∏–Ω—Ü–∏–ø #2: –°–æ—Å—Ç–æ—è–Ω–∏–µ –ü–æ—Ç–æ–∫–∞',
    content: `–î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ –≥–ª—É–±–æ–∫–æ–π –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏–∏, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–π –∫–æ–¥ "–ø–∏—à–µ—Ç—Å—è —Å–∞–º". –≠—Ç–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏ —Ç–≤–æ—Ä—á–µ—Å–∫–æ–≥–æ —Å–∞–º–æ–≤—ã—Ä–∞–∂–µ–Ω–∏—è.`,
  });

  // –°–ª–∞–π–¥ 5: –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Ö–Ω–∏–∫–∏
  slides.push({
    order: 5,
    type: 'practice',
    title: 'üßò‚Äç‚ôÇÔ∏è –£—Ç—Ä–µ–Ω–Ω–∏–µ –ü—Ä–∞–∫—Ç–∏–∫–∏',
    content: `‚Ä¢ 5-10 –º–∏–Ω—É—Ç –º–µ–¥–∏—Ç–∞—Ü–∏–∏ –ø–µ—Ä–µ–¥ —Ä–∞–±–æ—Ç–æ–π
‚Ä¢ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞–º–µ—Ä–µ–Ω–∏—è –Ω–∞ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –∫–æ–¥  
‚Ä¢ –û—á–∏—â–µ–Ω–∏–µ —É–º–∞ –æ—Ç –æ—Ç–≤–ª–µ–∫–∞—é—â–∏—Ö –º—ã—Å–ª–µ–π
‚Ä¢ –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–Ω—è —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º–∏`,
  });

  // –°–ª–∞–π–¥ 6: –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
  slides.push({
    order: 6,
    type: 'tools',
    title: 'üõ†Ô∏è –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã',
    content: `AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç—ã: GitHub Copilot, ChatGPT, Claude
–°—Ä–µ–¥—ã: VS Code, Vim, JetBrains IDEs
–ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏–∏: Pomodoro, TDD, Clean Code
–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥: –º–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –∏ –ª–∏—á–Ω–æ–π —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏`,
  });

  // –°–ª–∞–π–¥ 7: –ü—Å–∏—Ö–æ–ª–æ–≥–∏—è –∏ –º–æ—Ç–∏–≤–∞—Ü–∏—è
  slides.push({
    order: 7,
    type: 'psychology',
    title: 'üé≠ –ü—Å–∏—Ö–æ–ª–æ–≥–∏—è –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞',
    content: `–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–µ—Å—Å–æ–º —á–µ—Ä–µ–∑ –¥—ã—Ö–∞—Ç–µ–ª—å–Ω—ã–µ —Ç–µ—Ö–Ω–∏–∫–∏. –†–∞–±–æ—Ç–∞ —Å —Å–∏–Ω–¥—Ä–æ–º–æ–º —Å–∞–º–æ–∑–≤–∞–Ω—Ü–∞. –ü–æ–¥–¥–µ—Ä–∂–∞–Ω–∏–µ –º–æ—Ç–∏–≤–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ –º–∞–ª–µ–Ω—å–∫–∏–µ –ø–æ–±–µ–¥—ã –∏ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ.`,
  });

  // –°–ª–∞–π–¥ 8: –ú–µ—Ç—Ä–∏–∫–∏ –∏ –∏–∑–º–µ—Ä–µ–Ω–∏—è
  slides.push({
    order: 8,
    type: 'metrics',
    title: 'üìä –ö–∞–∫ –ò–∑–º–µ—Ä–∏—Ç—å –ü—Ä–æ–≥—Ä–µ—Å—Å?',
    content: `–ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏: —Å–Ω–∏–∂–µ–Ω–∏–µ –±–∞–≥–æ–≤, —É—Å–∫–æ—Ä–µ–Ω–∏–µ –∫–æ–¥-—Ä–µ–≤—å—é, —É–ª—É—á—à–µ–Ω–∏–µ —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏.
–õ–∏—á–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏: —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–æ–π, —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –∫ —Ñ–æ–∫—É—Å—É, work-life –±–∞–ª–∞–Ω—Å.`,
  });

  // –°–ª–∞–π–¥ 9: –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–Ω–¥—ã 2025
  slides.push({
    order: 9,
    type: 'trends',
    title: 'üî• –¢—Ä–µ–Ω–¥—ã 2025',
    content: `75% —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∏—Å–ø–æ–ª—å–∑—É—é—Ç AI –µ–∂–µ–¥–Ω–µ–≤–Ω–æ. –ú–µ–¥–∏—Ç–∞—Ç–∏–≤–Ω–æ–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞–±–∏—Ä–∞–µ—Ç –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å. –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞ –≤–∞–∂–Ω–µ–µ —Å–∫–æ—Ä–æ—Å—Ç–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.`,
  });

  // –°–ª–∞–π–¥ 10: –ó–∞–∫–ª—é—á–µ–Ω–∏–µ –∏ –ø—Ä–∏–∑—ã–≤ –∫ –¥–µ–π—Å—Ç–≤–∏—é
  slides.push({
    order: 10,
    type: 'conclusion',
    title: 'üöÄ –ù–∞—á–Ω–∏ –°–≤–æ–π –ü—É—Ç—å',
    content: `VibeCoding ‚Äî —ç—Ç–æ —ç–≤–æ–ª—é—Ü–∏—è –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è. –ù–∞—á–Ω–∏ —Å 5-–º–∏–Ω—É—Ç–Ω–æ–π –º–µ–¥–∏—Ç–∞—Ü–∏–∏ –∑–∞–≤—Ç—Ä–∞ —É—Ç—Ä–æ–º. –ò—Å–ø–æ–ª—å–∑—É–π AI-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ. –°—Ç—Ä–µ–º–∏—Å—å –∫ –∫–∞—á–µ—Å—Ç–≤—É, –∞ –Ω–µ —Å–∫–æ—Ä–æ—Å—Ç–∏.`,
  });

  logger.info('‚úÖ –°–æ–∑–¥–∞–Ω–æ 10 –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã—Ö —Å–ª–∞–π–¥–æ–≤', {
    type: LogType.BUSINESS_LOGIC,
    data: {
      slidesCount: slides.length,
      theme: theme.name,
      slideTypes: slides.map(s => s.type),
    },
  });

  return slides;
}

/**
 * üé≤ –ü–æ–ª—É—á–∞–µ—Ç —Ç–µ–º—É –¥–Ω—è –∏–ª–∏ —Å–ª—É—á–∞–π–Ω—É—é —Ç–µ–º—É
 */
function getDailyTheme() {
  const today = new Date();
  const dayOfWeek = today.getDay(); // 0 = –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ, 1 = –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫, etc.

  const theme =
    DAILY_VIBECODING_THEMES[dayOfWeek as keyof typeof DAILY_VIBECODING_THEMES];

  logger.info(`üìÖ –í—ã–±—Ä–∞–Ω–∞ —Ç–µ–º–∞ –¥–Ω—è: ${theme.name}`, {
    type: LogType.BUSINESS_LOGIC,
    data: {
      dayOfWeek,
      themeName: theme.name,
      categories: theme.categories,
      query: theme.query,
    },
  });

  return theme;
}

/**
 * üé≠ Fallback –∫–æ–Ω—Ç–µ–Ω—Ç –≤—ã—Å–æ–∫–æ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞ –¥–ª—è –∫–∞–∂–¥–æ–π —Ç–µ–º—ã –¥–Ω—è
 */
function getFallbackContent(theme: any) {
  const fallbackContentMap: Record<string, { title: string; content: string }> =
    {
      '–û—Å–Ω–æ–≤—ã –∏ –§–∏–ª–æ—Å–æ—Ñ–∏—è VibeCoding': {
        title: 'üßò‚Äç‚ôÇÔ∏è –§–∏–ª–æ—Å–æ—Ñ–∏—è VibeCoding',
        content: `# –ü—É—Ç—å VibeCoder'–∞

VibeCoding ‚Äî —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ –ø–æ–¥—Ö–æ–¥ –∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—é, —ç—Ç–æ **–º–µ–¥–∏—Ç–∞—Ç–∏–≤–Ω–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–¥–∞**.

## üå± –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã:

**üí´ –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ—Ç–æ–∫–∞** - –í–æ–π–¥–∏ –≤ –º–µ–¥–∏—Ç–∞—Ç–∏–≤–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–µ—Ä–µ–¥ –∫–æ–¥–∏–Ω–≥–æ–º. –û—Ç–∫–ª—é—á–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è, –Ω–∞—Å—Ç—Ä–æ–π —Å—Ä–µ–¥—É, –¥—ã—à–∏ –≥–ª—É–±–æ–∫–æ.

**üéØ –û—Å–æ–∑–Ω–∞–Ω–Ω–æ–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ** - –ö–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ –∫–æ–¥–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –Ω–∞–ø–∏—Å–∞–Ω–∞ —Å –ø–æ–ª–Ω—ã–º –ø–æ–Ω–∏–º–∞–Ω–∏–µ–º –µ—ë —Ü–µ–ª–∏ –∏ –º–µ—Å—Ç–∞ –≤ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ.

**‚ö° –ö–∞—á–µ—Å—Ç–≤–æ –≤–∞–∂–Ω–µ–µ —Å–∫–æ—Ä–æ—Å—Ç–∏** - –õ—É—á—à–µ –Ω–∞–ø–∏—Å–∞—Ç—å 10 —Å—Ç—Ä–æ–∫ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞, —á–µ–º 100 —Å—Ç—Ä–æ–∫ —Ö–∞–æ—Å–∞.

VibeCoding ‚Äî —ç—Ç–æ –ø—É—Ç—å –∫ –≥–∞—Ä–º–æ–Ω–∏–∏ –º–µ–∂–¥—É —Ä–∞–∑—É–º–æ–º –∏ –∫–æ–¥–æ–º.`,
      },
      'Cursor AI –∏ –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã': {
        title: 'üõ†Ô∏è –ú–∞—Å—Ç–µ—Ä—Å—Ç–≤–æ Cursor AI',
        content: `# Cursor AI ‚Äî –¢–≤–æ–π –¶–∏—Ñ—Ä–æ–≤–æ–π –ù–∞–ø–∞—Ä–Ω–∏–∫

Cursor AI –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è –≤ **–∏–Ω—Ç—É–∏—Ç–∏–≤–Ω—ã–π –¥–∏–∞–ª–æ–≥ —Å –∫–æ–¥–æ–º**.

## üöÄ –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:

**üí¨ –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–π AI** - Cursor –ø–æ–Ω–∏–º–∞–µ—Ç –≤—Å—é —Ç–≤–æ—é –∫–æ–¥–æ–≤—É—é –±–∞–∑—É –∏ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç —Ä–µ—à–µ–Ω–∏—è —Å —É—á—ë—Ç–æ–º –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã.

**‚ö° –ë—ã—Å—Ç—Ä–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - –ù–∞–∂–º–∏ Cmd+K –∏ –æ–ø–∏—à–∏ —á—Ç–æ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å. AI —Å–¥–µ–ª–∞–µ—Ç —ç—Ç–æ –∑–∞ —Å–µ–∫—É–Ω–¥—ã.

–° Cursor AI —Ç—ã –Ω–µ –ø—Ä–æ—Å—Ç–æ –ø–∏—à–µ—à—å –∫–æ–¥ ‚Äî —Ç—ã **—Ç–≤–æ—Ä–∏—à—å —Ü–∏—Ñ—Ä–æ–≤—ã–µ —Ä–µ—à–µ–Ω–∏—è**.`,
      },
      '–ú–µ–¥–∏—Ç–∞—Ç–∏–≤–Ω—ã–µ –ü—Ä–∞–∫—Ç–∏–∫–∏ –∏ Flow': {
        title: 'üßò‚Äç‚ôÇÔ∏è –ú–µ–¥–∏—Ç–∞—Ç–∏–≤–Ω–æ–µ –ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ',
        content: `# –í–æ–π–¥–∏ –≤ –°–æ—Å—Ç–æ—è–Ω–∏–µ –ü–æ—Ç–æ–∫–∞

–ú–µ–¥–∏—Ç–∞—Ç–∏–≤–Ω–æ–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Äî —ç—Ç–æ **–∏—Å–∫—É—Å—Å—Ç–≤–æ –±—ã—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—â–∏–º –≤ –∫–æ–¥–µ**.

## üå∏ –ü—Ä–∞–∫—Ç–∏–∫–∏ –¥–ª—è Flow:

**üåÖ –£—Ç—Ä–µ–Ω–Ω–∏–π —Ä–∏—Ç—É–∞–ª** - –ù–∞—á–∏–Ω–∞–π –¥–µ–Ω—å —Å 5-–º–∏–Ω—É—Ç–Ω–æ–π –º–µ–¥–∏—Ç–∞—Ü–∏–∏. –ù–∞—Å—Ç—Ä–æ–π –Ω–∞–º–µ—Ä–µ–Ω–∏–µ –Ω–∞ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –∫–æ–¥.

**‚è∞ –¢–µ—Ö–Ω–∏–∫–∞ Pomodoro** - 25 –º–∏–Ω—É—Ç –≥–ª—É–±–æ–∫–æ–π –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏–∏, 5 –º–∏–Ω—É—Ç –æ—Ç–¥—ã—Ö–∞. –ü–æ–≤—Ç–æ—Ä—è–π —Ü–∏–∫–ª—ã.

–ü–æ–º–Ω–∏: **–ª—É—á—à–∏–π –∫–æ–¥ —Ä–æ–∂–¥–∞–µ—Ç—Å—è –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –ø–æ–∫–æ—è**.`,
      },
      '–ú–∏—Ñ—ã –∏ –†–µ–∞–ª—å–Ω–æ—Å—Ç—å VibeCoding': {
        title: 'üïâÔ∏è –ú–∏—Ñ—ã –æ VibeCoding',
        content: `# –†–∞–∑–≤–µ–Ω—á–∏–≤–∞–µ–º –ú–∏—Ñ—ã

VibeCoding –æ–∫—Ä—É–∂—ë–Ω –º–Ω–æ–∂–µ—Å—Ç–≤–æ–º **–∑–∞–±–ª—É–∂–¥–µ–Ω–∏–π –∏ —Å—Ç–µ—Ä–µ–æ—Ç–∏–ø–æ–≤**.

## ‚ú® –ò—Å—Ç–∏–Ω–Ω–∞—è —Å—É—Ç—å:

VibeCoding ‚Äî —ç—Ç–æ **—Ñ–∏–ª–æ—Å–æ—Ñ–∏—è –∫–∞—á–µ—Å—Ç–≤–∞** –≤ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–∏. –≠—Ç–æ –Ω–µ –ø—Ä–æ —Å–∫–æ—Ä–æ—Å—Ç—å, –∞ –ø—Ä–æ **—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∏ —ç–ª–µ–≥–∞–Ω—Ç–Ω–æ—Å—Ç—å —Ä–µ—à–µ–Ω–∏–π**.

–ü–æ–º–Ω–∏: **–º–∞—Å—Ç–µ—Ä—Å—Ç–≤–æ –Ω–µ –≤ —Ç–æ–º, —á—Ç–æ–±—ã –ø–∏—Å–∞—Ç—å –∫–æ–¥ –±—ã—Å—Ç—Ä–æ, –∞ –≤ —Ç–æ–º, —á—Ç–æ–±—ã –ø–∏—Å–∞—Ç—å –µ–≥–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ**.`,
      },
    };

  return (
    fallbackContentMap[theme.name] || {
      title: 'üßò‚Äç‚ôÇÔ∏è VibeCoding –ú—É–¥—Ä–æ—Å—Ç—å',
      content: `# –ü—É—Ç—å VibeCoder'–∞

VibeCoding ‚Äî —ç—Ç–æ –º–µ–¥–∏—Ç–∞—Ç–∏–≤–Ω–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞.

## –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã:
- –û—Å–æ–∑–Ω–∞–Ω–Ω–æ–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ  
- –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ—Ç–æ–∫–∞
- –ö–∞—á–µ—Å—Ç–≤–æ –≤–∞–∂–Ω–µ–µ —Å–∫–æ—Ä–æ—Å—Ç–∏
- –ü–æ—Å—Ç–æ—è–Ω–Ω–æ–µ —Å–æ–≤–µ—Ä—à–µ–Ω—Å—Ç–≤–æ–≤–∞–Ω–∏–µ

–°–æ–∑–¥–∞–≤–∞–π –Ω–µ –ø—Ä–æ—Å—Ç–æ –∫–æ–¥, –∞ —Ü–∏—Ñ—Ä–æ–≤—É—é –≥–∞—Ä–º–æ–Ω–∏—é.`,
    }
  );
}

/**
 * üé® –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Ä–∞—Å—Å—ã–ª–∫–∏ VibeCoding –∫–∞—Ä—É—Å–µ–ª–∏
 */
const functionName = 'vibeCodingBroadcast';

//  cron: '0 * * * *' // –ö–∞–∂–¥—ã–π —á–∞—Å
// cron: '*/5 * * * *' // –ö–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
export const vibeCodingBroadcast = inngest.createFunction(
  {
    id: functionName,
    name: 'VibeCoding Hourly Broadcast',
    retries: 3,
  },
  {
    cron: '0 * * * *', // Each hour at :00
  },
  async ({ step }) => {
    const startTime = Date.now();

    try {
      // üé≤ –®–∞–≥ 1: –ü–æ–ª—É—á–∞–µ–º —Ç–µ–º—É –¥–Ω—è –∏–ª–∏ —Å–ª—É—á–∞–π–Ω—É—é —Ç–µ–º—É
      const theme = getDailyTheme();

      // üîç –®–∞–≥ 2: –ü–æ–ª—É—á–∞–µ–º –±–∞–∑–æ–≤—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç –∏–∑ –≤–µ–∫—Ç–æ—Ä–Ω–æ–π –±–∞–∑—ã
      const baseContent = await step.run('get-base-content', async () => {
        logger.info('üîç –ü–æ–ª—É—á–∞–µ–º –±–∞–∑–æ–≤—ã–π VibeCoding –∫–æ–Ω—Ç–µ–Ω—Ç', {
          type: LogType.BUSINESS_LOGIC,
        });

        // üîß –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤ –≤–µ–∫—Ç–æ—Ä–Ω–æ–π –±–∞–∑–µ
        const searchResult = await vectorService.hybridSearch(theme.query, {
          limit: 1,
        });

        // üéØ –£–ú–ù–´–ô FALLBACK: –µ—Å–ª–∏ –±–∞–∑–∞ –ø—É—Å—Ç–∞—è, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç
        if (
          !searchResult.combinedResults ||
          searchResult.combinedResults.length === 0
        ) {
          logger.info('üì¶ –í–µ–∫—Ç–æ—Ä–Ω–∞—è –±–∞–∑–∞ –ø—É—Å—Ç–∞—è, –∏—Å–ø–æ–ª—å–∑—É–µ–º fallback –∫–æ–Ω—Ç–µ–Ω—Ç', {
            type: LogType.BUSINESS_LOGIC,
            data: { theme: theme.name },
          });

          // üé≠ –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π fallback –∫–æ–Ω—Ç–µ–Ω—Ç –ø–æ —Ç–µ–º–∞–º –¥–Ω—è
          const fallbackContent = getFallbackContent(theme);
          return {
            title: fallbackContent.title,
            content: fallbackContent.content,
            category: theme.categories[0],
            sourceFile: 'fallback',
          };
        }

        const result = searchResult.combinedResults[0];
        return {
          title: result.title || theme.name,
          content: result.content,
          category: result.metadata?.file_category || theme.categories[0],
          sourceFile: result.sourceFile,
        };
      });

      // üåê –®–∞–≥ 3: –í–µ–±-–ø–æ–∏—Å–∫ –¥–ª—è –æ–±–æ–≥–∞—â–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞
      const webSearchData = await step.run(
        'web-search-enhancement',
        async () => {
          return await performWebSearch(theme.query, theme);
        }
      );

      // ü§ñ –®–∞–≥ 4: AI-–æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞
      const enhancedContent = await step.run(
        'ai-content-enhancement',
        async () => {
          return await enhanceContentWithAI(
            baseContent.content,
            webSearchData,
            theme
          );
        }
      );

      logger.info('‚úÖ –ö–æ–Ω—Ç–µ–Ω—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω –∏ —É–ª—É—á—à–µ–Ω', {
        type: LogType.BUSINESS_LOGIC,
        data: {
          title: baseContent.title,
          originalLength: baseContent.content.length,
          enhancedLength: enhancedContent.length,
          webSearchDataLength: webSearchData.length,
        },
      });

      // üé® –®–∞–≥ 5: –°–æ–∑–¥–∞–µ–º 10 –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã—Ö —Å–ª–∞–π–¥–æ–≤
      const slides = await step.run('create-professional-slides', async () => {
        logger.info('üé® –°–æ–∑–¥–∞–µ–º 10 –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã—Ö —Å–ª–∞–π–¥–æ–≤ –∫–∞—Ä—É—Å–µ–ª–∏', {
          type: LogType.BUSINESS_LOGIC,
        });

        return createProfessionalSlides(
          enhancedContent,
          baseContent.title,
          theme
        );
      });

      // üé® –®–∞–≥ 6: –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–∞—Ä—É—Å–µ–ª–∏
      const imageBuffers = await step.run(
        'generate-carousel-images',
        async () => {
          logger.info('üñºÔ∏è –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–∞—Ä—É—Å–µ–ª–∏', {
            type: LogType.BUSINESS_LOGIC,
            data: { slidesCount: slides.length },
          });

          // üåå GALAXY SPIRAL BLUR - –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–¥–µ–∞–ª—å–Ω—ã–π —Ç–µ–º–ø–ª–µ–π—Ç
          const randomTemplate = ColorTemplate.GALAXY_SPIRAL_BLUR;

          logger.info('üé® –í—ã–±—Ä–∞–Ω —Ü–≤–µ—Ç–æ–≤–æ–π —à–∞–±–ª–æ–Ω', {
            type: LogType.BUSINESS_LOGIC,
            data: { template: randomTemplate },
          });

          // üîß –ò–°–ü–û–õ–¨–ó–£–ï–ú –°–£–©–ï–°–¢–í–£–Æ–©–£–Æ –§–£–ù–ö–¶–ò–Æ!
          return await instagramCanvasService.generateCarouselImages(
            slides,
            undefined,
            randomTemplate
          );
        }
      );

      logger.info('‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–∞—Ä—É—Å–µ–ª–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã', {
        type: LogType.BUSINESS_LOGIC,
        data: { imagesCount: imageBuffers.length },
      });

      // üîç –®–∞–≥ 7: –ü–æ–ª—É—á–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
      const activeUsers = await step.run('fetch-active-users', async () => {
        logger.info('üë• –ü–æ–ª—É—á–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è —Ä–∞—Å—Å—ã–ª–∫–∏', {
          type: LogType.BUSINESS_LOGIC,
        });

        if (!db) {
          throw new Error('Database connection not available');
        }

        const usersWithSettings = await db
          .select({
            telegram_id: users.telegramId,
            username: users.username,
            first_name: users.first_name,
            language_code: users.language_code,
            notifications_enabled: userSettings.notifications_enabled,
          })
          .from(users)
          .innerJoin(userSettings, eq(users.id, userSettings.userId))
          .where(eq(userSettings.notifications_enabled, true)); // üöÄ –†–∞—Å—Å—ã–ª–∫–∞ –¥–ª—è –í–°–ï–•, —É –∫–æ–≥–æ –≤–∫–ª—é—á–µ–Ω—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

        logger.info(
          `üì± –ù–∞–π–¥–µ–Ω–æ ${usersWithSettings.length} –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π`,
          {
            type: LogType.BUSINESS_LOGIC,
            data: { count: usersWithSettings.length },
          }
        );

        return usersWithSettings;
      });

      if (activeUsers.length === 0) {
        logger.info('ü§∑‚Äç‚ôÇÔ∏è –ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è —Ä–∞—Å—Å—ã–ª–∫–∏', {
          type: LogType.BUSINESS_LOGIC,
        });
        return { success: true, message: 'No active users found' };
      }

      // üì§ –®–∞–≥ 8: –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–∞—Ä—É—Å–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
      const broadcastResults = await step.run('send-to-users', async () => {
        logger.info('üì§ –ù–∞—á–∏–Ω–∞–µ–º —Ä–∞—Å—Å—ã–ª–∫—É –∫–∞—Ä—É—Å–µ–ª–∏', {
          type: LogType.BUSINESS_LOGIC,
          data: { totalUsers: activeUsers.length },
        });

        let successCount = 0;
        let errorCount = 0;

        // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –º–µ–¥–∏–∞ –≥—Ä—É–ø–ø—É
        const mediaGroup: InputMediaPhoto[] = imageBuffers.map(
          (buffer, index) => {
            // üîß –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç Buffer –¥–ª—è Telegram API
            const imageBuffer = Buffer.isBuffer(buffer)
              ? buffer
              : Buffer.from((buffer as any).data || buffer);

            return {
              type: 'photo' as const,
              media: { source: imageBuffer }, // ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π Buffer —Ñ–æ—Ä–º–∞—Ç
              caption:
                index === 0
                  ? `${theme.emoji} **${theme.name}**\n\n` +
                    `üìù ${baseContent.title}\n\n` +
                    `üìö –ò—Å—Ç–æ—á–Ω–∏–∫: ${baseContent.sourceFile} + AI Enhancement\n` +
                    `üåê –û–±–æ–≥–∞—â–µ–Ω–æ –≤–µ–±-–ø–æ–∏—Å–∫–æ–º –∏ AI-–æ–±—Ä–∞–±–æ—Ç–∫–æ–π\n` +
                    `üìÖ ${new Date().toLocaleDateString('ru-RU', {
                      weekday: 'long',
                      day: 'numeric',
                      month: 'long',
                      timeZone: 'Europe/Moscow',
                    })}\n\n` +
                    `#VibeCoding #${theme.name.replace(/\s+/g, '')} #–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ–í–î—É—Ö–µ #AI2025`
                  : undefined,
              parse_mode: 'Markdown' as const,
            };
          }
        );

        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –±–∞—Ç—á–∞–º–∏ –ø–æ 10 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        const BATCH_SIZE = 10;
        for (let i = 0; i < activeUsers.length; i += BATCH_SIZE) {
          const batch = activeUsers.slice(i, i + BATCH_SIZE);

          await Promise.allSettled(
            batch.map(async user => {
              try {
                await bot.telegram.sendMediaGroup(
                  user.telegram_id,
                  mediaGroup as any
                );
                successCount++;

                logger.info(
                  `‚úÖ –ö–∞—Ä—É—Å–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é ${user.telegram_id}`,
                  {
                    type: LogType.BUSINESS_LOGIC,
                    data: {
                      telegram_id: user.telegram_id,
                      username: user.username,
                    },
                  }
                );
              } catch (error) {
                errorCount++;
                logger.error(
                  `‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é ${user.telegram_id}`,
                  {
                    type: LogType.ERROR,
                    error:
                      error instanceof Error ? error : new Error(String(error)),
                    data: {
                      telegram_id: user.telegram_id,
                      username: user.username,
                    },
                  }
                );
              }
            })
          );

          // –ü–∞—É–∑–∞ –º–µ–∂–¥—É –±–∞—Ç—á–∞–º–∏
          if (i + BATCH_SIZE < activeUsers.length) {
            await new Promise(resolve => setTimeout(resolve, 1000));
          }
        }

        return { successCount, errorCount, totalUsers: activeUsers.length };
      });

      const executionTime = Date.now() - startTime;

      logger.info('üéâ VibeCoding —Ä–∞—Å—Å—ã–ª–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞', {
        type: LogType.BUSINESS_LOGIC,
        data: {
          ...broadcastResults,
          executionTime: `${executionTime}ms`,
          title: baseContent.title,
          theme: theme.name,
          slidesCount: slides.length,
        },
      });

      return {
        success: true,
        message: `–†–∞—Å—Å—ã–ª–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞: ${broadcastResults.successCount}/${broadcastResults.totalUsers} —É—Å–ø–µ—à–Ω–æ`,
        stats: broadcastResults,
        executionTime,
      };
    } catch (error) {
      const errorMessage =
        error instanceof Error ? error.message : String(error);
      logger.error('‚ùå –û—à–∏–±–∫–∞ –≤ VibeCoding broadcast', {
        type: LogType.BUSINESS_LOGIC,
        error: error instanceof Error ? error : new Error(errorMessage),
      });

      // üöÄ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ –≤ Telegram –∞–¥–º–∏–Ω—É
      if (process.env.ADMIN_CHAT_ID) {
        try {
          await bot.telegram.sendMessage(
            process.env.ADMIN_CHAT_ID,
            `‚ùå *–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –≤ VibeCoding Broadcast*\n\n*–í—Ä–µ–º—è:* ${new Date().toISOString()}\n*–û—à–∏–±–∫–∞:*\n\`\`\`\n${errorMessage.slice(
              0,
              500
            )}\n\`\`\``,
            { parse_mode: 'Markdown' }
          );
          logger.info(`‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –∞–¥–º–∏–Ω—É`);
        } catch (telegramError) {
          logger.error('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ –∞–¥–º–∏–Ω—É', {
            error: telegramError as Error,
          });
        }
      }
      throw error;
    }
  }
);
