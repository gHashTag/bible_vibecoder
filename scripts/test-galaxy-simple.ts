/**
 * üåå –ü—Ä–æ—Å—Ç–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Galaxy Spiral Blur —Å—Ç–∏–ª—è
 *
 * –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–∞—Ä—Ç–æ—á–µ–∫ Galaxy Spiral Blur —Å –Ω–æ–≤—ã–º–∏
 * –∫–≤–∞–¥—Ä–∞—Ç–Ω—ã–º–∏ –ø—Ä–æ–ø–æ—Ä—Ü–∏—è–º–∏ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ (800x800px)
 */

import {
  InstagramCanvasService,
  ColorTemplate,
} from '../src/services/instagram-canvas.service';
import type { CarouselSlide } from '../src/types';
import fs from 'fs';
import path from 'path';

const canvasService = new InstagramCanvasService();

// üåå –¢–µ—Å—Ç–æ–≤—ã–µ —Å–ª–∞–π–¥—ã –¥–ª—è Galaxy —Å—Ç–∏–ª—è
const GALAXY_TEST_SLIDES: CarouselSlide[] = [
  {
    order: 1,
    type: 'title',
    title: 'üåå Galaxy Spiral Flow',
    content:
      '–ú–µ–¥–∏—Ç–∞—Ç–∏–≤–Ω–æ–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –∫–æ—Å–º–∏—á–µ—Å–∫–∏—Ö –º–∞—Å—à—Ç–∞–±–∞—Ö –≥–∞–ª–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö —Å–ø–∏—Ä–∞–ª–µ–π',
  },
  {
    order: 2,
    type: 'principle',
    title: '‚ú® –ö–æ—Å–º–∏—á–µ—Å–∫–∞—è –ú—É–¥—Ä–æ—Å—Ç—å VibeCoding',
    content:
      '–ö–æ–¥ —Ç–µ—á–µ—Ç –∫–∞–∫ —Å–ø–∏—Ä–∞–ª–∏ –≥–∞–ª–∞–∫—Ç–∏–∫ ‚Äî –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ, —ç–ª–µ–≥–∞–Ω—Ç–Ω–æ, —Å –≥–ª—É–±–æ–∫–∏–º —Å–º—ã—Å–ª–æ–º. –ö–∞–∂–¥–∞—è —Ñ—É–Ω–∫—Ü–∏—è ‚Äî –∑–≤–µ–∑–¥–∞ –≤ —Å–æ–∑–≤–µ–∑–¥–∏–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã.',
  },
  {
    order: 3,
    type: 'practice',
    title: 'üå† –ü—Ä–∞–∫—Ç–∏–∫–∞ –ì–∞–ª–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ –ü–æ—Ç–æ–∫–∞',
    content:
      '–ü—Ä–µ–¥—Å—Ç–∞–≤—å —Å–≤–æ–π –∫–æ–¥ –∫–∞–∫ –≥–∞–ª–∞–∫—Ç–∏–∫—É: —Ü–µ–Ω—Ç—Ä ‚Äî —è–¥—Ä–æ –ª–æ–≥–∏–∫–∏, —Å–ø–∏—Ä–∞–ª–∏ ‚Äî –º–æ–¥—É–ª–∏, –∑–≤–µ–∑–¥—ã ‚Äî —Ñ—É–Ω–∫—Ü–∏–∏. –ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä—É–π —Å –∫–æ—Å–º–∏—á–µ—Å–∫–∏–º —Ä–∞–∑–º–∞—Ö–æ–º!',
  },
  {
    order: 4,
    type: 'summary',
    title: 'üéØ –ì–∞–ª–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ',
    content:
      '–ù–∞—á–Ω–∏ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –∫–æ–¥–∏–Ω–≥–∞ —Å –º–µ–¥–∏—Ç–∞—Ü–∏–∏ –Ω–∞ —Å–ø–∏—Ä–∞–ª–∏ –≥–∞–ª–∞–∫—Ç–∏–∫. –ü–∏—à–∏ –∫–æ–¥ —Å –∫–æ—Å–º–∏—á–µ—Å–∫–æ–π –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–æ–π ‚Äî –¥—É–º–∞–π –≤ –º–∞—Å—à—Ç–∞–±–∞—Ö –≤—Å–µ–ª–µ–Ω–Ω–æ–π!',
  },
];

// –ü–∞–ø–∫–∞ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
const outputDir = './test-outputs/galaxy-spiral-simple';

async function generateGalaxySimple() {
  console.log(
    'üåå –¢–µ—Å—Ç–∏—Ä—É–µ–º Galaxy Spiral Blur —Å –∫–≤–∞–¥—Ä–∞—Ç–Ω—ã–º —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–º —ç–ª–µ–º–µ–Ω—Ç–æ–º...\n'
  );

  // –°–æ–∑–¥–∞–µ–º –≤—ã—Ö–æ–¥–Ω—É—é –ø–∞–ø–∫—É
  if (!fs.existsSync(outputDir)) {
    fs.mkdirSync(outputDir, { recursive: true });
  }

  let successCount = 0;
  let errorCount = 0;
  const startTime = Date.now();

  try {
    console.log('üé® –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∫–∞—Ä—É—Å–µ–ª—å Galaxy Spiral Blur...');

    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø–æ–ª–Ω—É—é –∫–∞—Ä—É—Å–µ–ª—å
    const imageBuffers = await canvasService.generateCarouselImages(
      GALAXY_TEST_SLIDES,
      undefined,
      ColorTemplate.GALAXY_SPIRAL_BLUR
    );

    console.log(`‚úÖ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ ${imageBuffers.length} –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π`);

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–∞–∂–¥–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
    for (const [index, buffer] of imageBuffers.entries()) {
      const filename = `galaxy_spiral_square_slide_${index + 1}.png`;
      const filePath = path.join(outputDir, filename);

      fs.writeFileSync(filePath, buffer);

      const fileSize = (fs.statSync(filePath).size / 1024).toFixed(0);
      console.log(`   üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ: ${filename} (${fileSize}KB)`);
      successCount++;
    }
  } catch (error) {
    console.error('üí• –û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ Galaxy –∫–∞—Ä—É—Å–µ–ª–∏:', error);
    errorCount++;
  }

  const totalTime = Date.now() - startTime;

  // –°–æ–∑–¥–∞–µ–º –æ—Ç—á–µ—Ç
  const report = `# üåå Galaxy Spiral Blur - –ö–≤–∞–¥—Ä–∞—Ç–Ω—ã–π —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- **–£—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ:** ${successCount} –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- **–û—à–∏–±–æ–∫:** ${errorCount}
- **–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** ${(totalTime / 1000).toFixed(1)}—Å
- **–ü–∞–ø–∫–∞ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏:** ${outputDir}

## üî≤ –ù–æ–≤—ã–µ –ø—Ä–æ–ø–æ—Ä—Ü–∏–∏:
- **–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç:** 800px √ó 800px (–∏–¥–µ–∞–ª—å–Ω—ã–π –∫–≤–∞–¥—Ä–∞—Ç)
- **Footer:** 800px —à–∏—Ä–∏–Ω—ã (–ø–æ–¥–æ–≥–Ω–∞–Ω –ø–æ–¥ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç)
- **–û—Ç—Å—Ç—É–ø:** 80px –º–µ–∂–¥—É —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–º –∏ –Ω–∏–∂–Ω–∏–º —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏
- **–ü—Ä–æ–ø–æ—Ä—Ü–∏–∏:** aspect-ratio: 1/1 –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∫–≤–∞–¥—Ä–∞—Ç–∞

## ‚ú® –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ Galaxy Spiral Blur:
- –§–æ–Ω–æ–≤—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑ –ø–∞–ø–∫–∏ bg-bible-vibecoding
- Glassmorphism —ç—Ñ—Ñ–µ–∫—Ç—ã —Å –≥–∞–ª–∞–∫—Ç–∏—á–µ—Å–∫–∏–º–∏ –∞–∫—Ü–µ–Ω—Ç–∞–º–∏
- –ë–µ–ª—ã–π —Ç–µ–∫—Å—Ç —Å —Ç–µ–Ω—è–º–∏ –¥–ª—è –æ—Ç–ª–∏—á–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–∞—Å—Ç–∞
- Backdrop-filter: blur(15px) –¥–ª—è –≥–ª—É–±–∏–Ω—ã –∏ –º–∏—Å—Ç–∏–∫–∏

## üé® –¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞:
- –û—Å–Ω–æ–≤–Ω–æ–π —Ü–≤–µ—Ç: –ì–∞–ª–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Å–∏–Ω–∏–π/—Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π –≥—Ä–∞–¥–∏–µ–Ω—Ç
- –ê–∫—Ü–µ–Ω—Ç—ã: –ó–≤–µ–∑–¥–Ω—ã–µ –±–ª–∏–∫–∏ –∏ –∫–æ—Å–º–∏—á–µ—Å–∫–∏–µ –ø–µ—Ä–µ–ª–∏–≤—ã
- –¢–µ–∫—Å—Ç: –ë–µ–ª—ã–π —Å –∫–æ—Å–º–∏—á–µ—Å–∫–∏–º–∏ —Ç–µ–Ω—è–º–∏
- Blur: 15px –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —ç—Ñ—Ñ–µ–∫—Ç–∞ –≥–ª—É–±–∏–Ω—ã –∫–æ—Å–º–æ—Å–∞

–î–∞—Ç–∞: ${new Date().toLocaleString('ru-RU')}
`;

  fs.writeFileSync(path.join(outputDir, 'galaxy-square-report.md'), report);

  console.log('\nüìã –ò–¢–û–ì–û–í–´–ô –û–¢–ß–ï–¢:');
  console.log(`‚úÖ –£—Å–ø–µ—à–Ω–æ: ${successCount} –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π`);
  console.log(`‚ùå –û—à–∏–±–æ–∫: ${errorCount}`);
  console.log(`‚è±Ô∏è –í—Ä–µ–º—è: ${(totalTime / 1000).toFixed(1)}—Å`);
  console.log(`üìÅ –ü–∞–ø–∫–∞: ${outputDir}`);
  console.log('\nüåå Galaxy —Å –∫–≤–∞–¥—Ä–∞—Ç–Ω—ã–º —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–º —ç–ª–µ–º–µ–Ω—Ç–æ–º –≥–æ—Ç–æ–≤!');

  if (successCount > 0) {
    console.log('\nüéØ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò:');
    console.log('- –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç —Ç–µ–ø–µ—Ä—å —Ç–æ—á–Ω–æ –∫–≤–∞–¥—Ä–∞—Ç–Ω—ã–π (800x800px)');
    console.log('- Footer –ø–æ–¥–æ–≥–Ω–∞–Ω –ø–æ–¥ —Ç—É –∂–µ —à–∏—Ä–∏–Ω—É –¥–ª—è –≥–∞—Ä–º–æ–Ω–∏–∏');
    console.log('- –û—Ç—Å—Ç—É–ø—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω—ã –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –Ω–∞–ª–æ–∂–µ–Ω–∏–π');
    console.log('- Galaxy —Å—Ç–∏–ª—å –æ—Ç–ª–∏—á–Ω–æ —Å–æ—á–µ—Ç–∞–µ—Ç—Å—è —Å –∫–≤–∞–¥—Ä–∞—Ç–Ω—ã–º–∏ –ø—Ä–æ–ø–æ—Ä—Ü–∏—è–º–∏!');
  }
}

// –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
generateGalaxySimple()
  .then(() => {
    console.log('\nüåå Galaxy Spiral Blur —Å –∫–≤–∞–¥—Ä–∞—Ç–Ω—ã–º–∏ –ø—Ä–æ–ø–æ—Ä—Ü–∏—è–º–∏ –≥–æ—Ç–æ–≤! ‚ú®');
  })
  .catch(error => {
    console.error('üí• –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞:', error);
    process.exit(1);
  });
